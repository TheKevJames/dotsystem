#!/usr/bin/env bash
set -euo pipefail

usage() {
    echo "$0 [-c COUNT] [-t TIMEOUT]"                >/dev/stderr;
    echo "  -c COUNT    maximum attempts"            >/dev/stderr;
    echo "  -t TIMEOUT  sleep time between attempts" >/dev/stderr;
}

COUNT=9999
TIMEOUT=10

while getopts 'c:ht:' flag; do
    case "${flag}" in
        c) COUNT="${OPTARG}" ;;
        t) TIMEOUT="${OPTARG}" ;;
        h) usage; exit 0 ;;
        ?) usage; exit 1 ;;
    esac
done

n=0
until [ $n -ge "${COUNT}" ]; do
    "$@" && break
    n=$((n+1))
    sleep "${TIMEOUT}"
done
